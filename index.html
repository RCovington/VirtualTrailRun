<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Virtual Trail Run - Scenic outdoor videos with head tracking for treadmill workouts">
    <title>Virtual Trail Run - POC</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="auth-ui.css">
</head>
<body>
    <!-- Splash Screen -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-content">
            <img id="splashLogo" alt="Virtual Trail Run" class="splash-logo">
            <h1 class="splash-title">Virtual Trail Run</h1>
            <div class="splash-loader"></div>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <img src="logo.svg" alt="Virtual Trail Run Logo" class="logo">
            <h1>üèÉ Virtual Trail Run</h1>
            <p class="subtitle">Proof of Concept: Video Streaming + Head Tracking</p>
        </header>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- YouTube Video Player -->
            <div class="video-container">
                <div id="player"></div>
                <div class="video-overlay" id="videoOverlay">
                    <button class="start-button" id="startButton">
                        üé• Start Workout
                    </button>
                </div>
                <!-- Health and Magic bars -->
                <div class="stats-bars" id="statsBars">
                    <div class="stat-bar">
                        <div class="stat-label">‚ù§Ô∏è</div>
                        <div class="stat-bar-container">
                            <div class="stat-bar-fill health-bar" id="healthBar"></div>
                        </div>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-label">‚ú®</div>
                        <div class="stat-bar-container">
                            <div class="stat-bar-fill magic-bar" id="magicBar"></div>
                        </div>
                    </div>
                </div>
                <!-- Collectibles game overlay -->
                <div id="collectiblesContainer">
                    <canvas id="collectiblesCanvas"></canvas>
                    <div class="collectibles-counter">
                        <span class="collectibles-icon">üå∞</span>
                        <span id="collectiblesCount">0</span>
                    </div>
                </div>
            </div>

            <!-- Camera Feed & Head Tracking Stats -->
            <div class="tracking-panel">
                <div class="camera-container">
                    <video id="cameraFeed" autoplay playsinline muted></video>
                    <canvas id="trackingCanvas"></canvas>
                    <canvas id="handDebugCanvas"></canvas>
                    <div class="camera-status" id="cameraStatus">
                        Camera Off
                    </div>
                </div>

                <div class="stats-panel">
                    <h3>Head Movement Stats</h3>
                    <div class="stat-item">
                        <span class="stat-label">Vertical Movement:</span>
                        <span class="stat-value" id="verticalMovement">0.0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Bobs per Minute:</span>
                        <span class="stat-value" id="bobsPerMinute">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Bobs:</span>
                        <span class="stat-value" id="totalBobs">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Workout Time:</span>
                        <span class="stat-value" id="workoutTime">0:00</span>
                    </div>
                    <div class="movement-indicator" id="movementIndicator">
                        <div class="indicator-bar" id="indicatorBar"></div>
                    </div>
                </div>

                <div class="controls">
                    <button class="control-button" id="toggleCamera">
                        üìπ Enable Camera
                    </button>
                    <button class="control-button" id="toggleFullscreen">
                        ‚õ∂ Fullscreen Video
                    </button>
                    <button class="control-button secondary" id="resetStats">
                        üîÑ Reset Stats
                    </button>
                </div>
            </div>
        </main>

        <!-- Video Selection -->
        <section class="video-selection">
            <h3>Choose Your Trail</h3>
            <div class="video-list">
                <button class="video-option" data-video-id="eg7nQ-H4kbI">
                    üèîÔ∏è Mountain Trail Run
                </button>
                <button class="video-option" data-video-id="1UMudXNH59I">
                    üå≤ Forest Path Walk
                </button>
                <button class="video-option" data-video-id="jHvt-RlxHO0">
                    üèñÔ∏è Beach Coastline Run
                </button>
                <button class="video-option" data-video-id="1UMudXNH59I">
                    üèôÔ∏è Urban City Walk
                </button>
            </div>
        </section>

        <!-- Info Panel -->
        <section class="info-panel">
            <h3>How It Works</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>1Ô∏è‚É£ Choose a Trail</h4>
                    <p>Select from scenic YouTube videos of outdoor trails and paths</p>
                </div>
                <div class="info-card">
                    <h4>2Ô∏è‚É£ Enable Camera</h4>
                    <p>Allow access to your front-facing camera for head tracking</p>
                </div>
                <div class="info-card">
                    <h4>3Ô∏è‚É£ Start Moving</h4>
                    <p>Walk or run on your treadmill - the app tracks your head movement</p>
                </div>
                <div class="info-card">
                    <h4>4Ô∏è‚É£ Track Progress</h4>
                    <p>Monitor your bobs per minute and workout duration</p>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>Proof of Concept - Built with YouTube IFrame API & TensorFlow.js</p>
            <p class="tech-stack">
                <span>Technologies: WebRTC ‚Ä¢ MediaPipe Face Mesh ‚Ä¢ YouTube API</span>
            </p>
        </footer>
    </div>

    <!-- Splash Screen Script -->
    <script>
        // Load random logo for splash screen
        (function() {
            const logos = [
                'logo-01.png', 'logo-02.png', 'logo-03.png', 'logo-4.png',
                'logo-05.png', 'logo-06.png', 'logo-07.png', 'logo-08.png',
                'logo-09.png', 'logo-10.png', 'logo-11.png', 'logo-12.png',
                'logo-13.png', 'logo-14.png', 'logo-15.png', 'logo-16.png',
                'logo-17.png', 'logo-18.png', 'logo-19.png', 'logo-20.png',
                'logo-21.png', 'logo-22.png', 'logo-23.png', 'logo-24.png'
            ];
            
            // Select random logo
            const randomLogo = logos[Math.floor(Math.random() * logos.length)];
            const splashLogo = document.getElementById('splashLogo');
            if (splashLogo) {
                splashLogo.src = `resources/logos/${randomLogo}`;
            }
            
            // Hide splash screen when page is fully loaded
            window.addEventListener('load', function() {
                setTimeout(function() {
                    const splash = document.getElementById('splashScreen');
                    if (splash) {
                        splash.classList.add('fade-out');
                        // Remove from DOM after animation completes
                        setTimeout(() => {
                            splash.remove();
                        }, 800);
                    }
                }, 1500); // Show for at least 1.5 seconds
            });
        })();
    </script>

    <!-- Authentication UI (included from auth-ui.html) -->
    <script>
        // Load auth UI dynamically
        fetch('auth-ui.html')
            .then(response => response.text())
            .then(html => {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                // Insert each top-level element from auth-ui.html
                const elements = Array.from(tempDiv.children);
                elements.forEach(element => {
                    document.body.appendChild(element);
                });
            })
            .catch(error => {
                console.error('Error loading auth UI:', error);
            });
    </script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>

    <!-- App Scripts -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/hand-pose-detection"></script>
    
    <!-- Firebase & App Modules (load in order) -->
    <script src="firebase-config.js"></script>
    <script src="cache.js"></script>
    <script src="analytics.js"></script>
    <script src="auth.js"></script>
    <script src="videoPlayer.js"></script>
    <script src="headTracker.js"></script>
    <script src="collectibles.js"></script>
    <script src="app.js"></script>
</body>
</html>
